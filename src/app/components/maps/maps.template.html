<div class="card maps" [@animation]="slideMap">
  <div class="card__header card__header--high" [ngStyle]="{'background-image': 'url(https://www.bungie.net' + (mapInfo$ | async)?.pgcrImage + ')'}">
    <div class="row middle-xs">
      <div class="col-xs">
        <h2 class="card__header__title" [innerHtml]="(mapInfo$ | async)?.name"></h2>
        <!-- TODO: Add popover in case of rotating maps -->
        <div class="data-label" [innerHtml]="(mapInfo$ | async)?.weekText + '\'s map'"></div>
      </div>
      <div class="col-xs-shrink">
        <div class="card__header__controls">
          <button class="btn btn--icon btn--ghost" [style.opacity]="(mapInfo$ | async)?.week > 1 ? 1 : .2" (click)="previousMap()">
            <i class="material-icons">&#xE5CB;</i>
          </button>
          <button class="btn btn--icon btn--ghost" [style.opacity]="(mapInfo$ | async)?.week == maxWeek ? .2 : 1" (click)="nextMap()">
            <i class="material-icons">&#xE5CC;</i>
          </button>
        </div>
        <div class="data-label">Other weeks</div>
      </div>
    </div>
  </div>
  <div class="card__content">
    <div class="row">
      <div class="col-xs-6 col-sm-3">
        <div class="stat__number" [innerHtml]="(mapInfo$ | async)?.lighthouse | number"></div>
        <div class="stat__label">Accounts flawless</div>
      </div>
      <div class="col-xs-6 col-sm-3 stat">
        <div class="stat__number" [innerHtml]="(mapInfo$ | async)?.players | number"></div>
        <div class="stat__label">Accounts participated</div>
      </div>
      <div class="col-xs-6 col-sm-3 stat">
        <div class="stat__number" [innerHtml]="(mapInfo$ | async)?.matches | number"></div>
        <div class="stat__label">Total matches</div>
      </div>
      <div class="col-xs-6 col-sm-3 stat">
        <div class="stat__number" [innerHtml]="(mapInfo$ | async)?.kills | number"></div>
        <div class="stat__label">Total kills</div>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-xs-12 col-sm-2" [tooltipHtml]="percentageNoticeText" [tooltipClass]="'popover'">
        <h3 class="stat-header">
          Weapon usage by type
        </h3>
        <span>
          <i class="material-icons icon--small info">&#xE8FD;</i>
        </span>
      </div>
      <div class="col-xs-12 col-sm-4">
        <div class="top-weapons--map">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <label class="top-weapons__label">Primary</label>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <label>Kills</label>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <label>Diff. to avg</label>
            </div>
          </div>
          <div class="row top-weapons--map__row" *ngFor='let weapon of (weaponUsage$ | async)?.primary'>
            <div class="col-xs-6 col-sm-4">
              <img class="weapon-type-icon img-responsive"
                   [src]="weapon?.file_name"
                   [alt]="weapon?.weapon_type">
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <span [innerHtml]="weapon?.killPercentage | number:'2.2-2'"></span>%
            </div>
            <div class="col-xs-3 col-sm-4 stat"
                 [ngClass]="{success: weapon?.diffPercentage > 0, fail: weapon?.diffPercentage < 0}">
              <i class="material-icons" [innerHtml]="weapon?.diffPercentage > 0 ? '&#xE5CE;' : '&#xE5CF;'"></i>
              <span [innerHtml]="weapon?.diffPercentage | number:'2.2-2'"></span>%
            </div>
          </div>
          <hr class="hr--minor visible-xs">
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-sm-offset-1">
        <div class="top-weapons--map">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <label class="top-weapons__label">Primary</label>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <label>Kills</label>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <label>Diff. to avg</label>
            </div>
          </div>
          <div class="row top-weapons--map__row" *ngFor='let weapon of (weaponUsage$ | async)?.special'>
            <div class="col-xs-6 col-sm-4">
              <img class="weapon-type-icon img-responsive"
                   [src]="weapon?.file_name"
                   [alt]="weapon?.weapon_type">
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <span [innerHtml]="weapon?.killPercentage | number:'2.2-2'"></span>%
            </div>
            <div class="col-xs-3 col-sm-4 stat"
                 [ngClass]="{success: weapon?.diffPercentage > 0, fail: weapon?.diffPercentage < 0}">
              <i class="material-icons" [innerHtml]="weapon?.diffPercentage > 0 ? '&#xE5CE;' : '&#xE5CF;'"></i>
              <span [innerHtml]="weapon?.diffPercentage | number:'2.2-2'"></span>%
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-xs-12 col-sm-2">
        <h3 class="stat-header">
          Top weapons from Guardian.gg
        </h3>
        <!--<a [href]="weaponStatsUrl" target="_blank" [tooltip]="tooltipText">-->
        <a>
          <i class="material-icons icon--small info">&#xE148;</i>
        </a>
      </div>
      <div class="col-xs-12 col-sm-10" *ngIf="!weapons || (!weapons.primary && !weapons.special)">
        <div class="first-in-lighthouse__undecided">
          Guardian.gg does not have any weapon stats to show (yet!).
        </div>
      </div>
      <template [ngIf]="weapons">
        <div class="col-xs-12 col-sm-5" *ngFor='let type of [weapons.primary, weapons.special]'>
          <template ngFor let-weapon [ngForOf]="type" let-i="index">
            <div class="row top-weapon" *ngIf="i < 3">
              <div class="col-xs-6 col-sm-7 last-weapon-weapon__descr">
                <img class="last-match-weapon__img img-responsive" [src]="'https://www.bungie.net' + weapon.icon"
                     [alt]="weapon.name">
                <span class="last-match-weapon__title" [innerHtml]="weapon.name"></span>
              </div>
              <div class="col-xs-6 col-sm-5 stat">
                <span [innerHtml]="weapon.kills | number:'2.0-2'"></span>%
              </div>
            </div>
          </template>
          <hr class="hr--minor visible-xs" *ngIf="i === 0">
        </div>
      </template>
    </div>
  </div>
</div>
