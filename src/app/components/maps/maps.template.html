<div class="maps">
  <div class="card" [@animation]="slideMap$ | async">
    <div class="card__header card__header--high" [ngStyle]="{'background-image': 'url(https://www.bungie.net' + (mapInfo$ | async)?.pgcrImage + ')'}">
      <div class="row middle-xs">
        <div class="col-xs">
          <h2 class="card__header__title" [innerHtml]="(mapInfo$ | async)?.name"></h2>
          <!-- TODO: Add popover in case of rotating maps -->
          <div class="data-label" [innerHtml]="(mapInfo$ | async)?.weekText + '\'s map'"></div>
        </div>
        <div class="col-xs-shrink">
          <div class="card__header__controls">
            <button class="btn btn--icon btn--ghost" [style.opacity]="(mapInfo$ | async)?.week > 1 ? 1 : .2" (click)="previousMap()">
              <i class="material-icons">&#xE5CB;</i>
            </button>
            <button class="btn btn--icon btn--ghost" [style.opacity]="(mapInfo$ | async)?.week == maxWeek ? .2 : 1" (click)="nextMap()">
              <i class="material-icons">&#xE5CC;</i>
            </button>
          </div>
          <div class="data-label">Other weeks</div>
        </div>
      </div>
    </div>
    <div class="card__content">
      <div class="row">
        <div class="col-xs-6 col-sm-3">
          <div class="stat-number" [innerHtml]="(mapInfo$ | async)?.lighthouse | number"></div>
          <div class="stat-label">Accounts flawless</div>
        </div>
        <div class="col-xs-6 col-sm-3 stat">
          <div class="stat-number" [innerHtml]="(mapInfo$ | async)?.players | number"></div>
          <div class="stat-label">Accounts participated</div>
        </div>
        <div class="col-xs-6 col-sm-3 stat">
          <div class="stat-number" [innerHtml]="(mapInfo$ | async)?.matches | number"></div>
          <div class="stat-label">Total matches</div>
        </div>
        <div class="col-xs-6 col-sm-3 stat">
          <div class="stat-number" [innerHtml]="(mapInfo$ | async)?.kills | number"></div>
          <div class="stat-label">Total kills</div>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-sm-2" [tooltipHtml]="percentageNoticeText" [tooltipClass]="'popover'">
          <h3 class="stat-title">
            Weapon usage by type
          </h3>
          <!-- <span>
            <i class="material-icons info">&#xE8FD;</i> TODO: Implement popovers
          </span> -->
        </div>
        <div class="stat-table col-xs-12 col-sm-5">
          <div class="stat-table__row row row--small-gutter">
            <div class="col-xs-6 col-sm-4">
              <div class="stat-header">Primary</div>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <div class="stat-label">Kills</div>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <div class="stat-label">Diff. to avg</div>
            </div>
          </div>
          <div class="stat-table__row row row--small-gutter middle-xs" *ngFor='let weapon of (primary$ | async)'>
            <div class="col-xs-6 col-sm-4">
              <img class="weapon-type-icon img-responsive"
                   [src]="weapon?.file_name"
                   [alt]="weapon?.weapon_type">
            </div>
            <div class="col-xs-3 col-sm-4">
              <span [innerHtml]="weapon?.killPercentage | number:'1.2-2'"></span>%
            </div>
            <div class="col-xs-3 col-sm-4"
                 [ngClass]="{'color-success': weapon?.diffPercentage >= 0, 'color-error': weapon?.diffPercentage < 0}">
              <i class="material-icons icon--small" [innerHtml]="weapon?.diffPercentage >= 0 ? '&#xE5CE;' : '&#xE5CF;'"></i>
              <span [innerHtml]="weapon?.diffPercentage | number:'1.2-2'"></span>%
            </div>
          </div>
        </div>
        <hr class="col-xs-12 col-sm-hidden hr--minor">
        <div class="stat-table col-xs-12 col-sm-5">
          <div class="stat-table__row row row--small-gutter">
            <div class="col-xs-6 col-sm-4">
              <div class="stat-header">Secondary</div>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <div class="stat-label">Kills</div>
            </div>
            <div class="col-xs-3 col-sm-4 stat">
              <div class="stat-label">Diff. to avg</div>
            </div>
          </div>
          <div class="stat-table__row row row--small-gutter" *ngFor='let weapon of (special$ | async)'>
            <div class="col-xs-6 col-sm-4">
              <img class="weapon-type-icon img-responsive"
                   [src]="weapon?.file_name"
                   [alt]="weapon?.weapon_type">
            </div>
            <div class="col-xs-3 col-sm-4">
              <span [innerHtml]="weapon?.killPercentage | number:'1.2-2'"></span>%
            </div>
            <div class="col-xs-3 col-sm-4"
                 [ngClass]="{'color-success': weapon?.diffPercentage > 0, 'color-error': weapon?.diffPercentage < 0}">
              <i class="material-icons icon--small" [innerHtml]="weapon?.diffPercentage > 0 ? '&#xE5CE;' : '&#xE5CF;'"></i>
              <span [innerHtml]="weapon?.diffPercentage | number:'1.2-2'"></span>%
            </div>
          </div>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-xs-12 col-sm-2">
          <h3 class="stat-title">
            Top weapons based on total kills
          </h3>
        </div>
        <div class="col-xs-12 col-sm-10" *ngIf="!(weapons$ | async)">
          <div class="first-in-lighthouse__undecided">
            We do not have any weapon stats to show (yet!).
          </div>
        </div>
        <div class="col-xs-12 col-sm-5" *ngFor='let type of (weapons$ | async)'>
          <template ngFor let-weapon [ngForOf]="type" let-i="index">
            <div class="row top-weapon" *ngIf="i < 3">
              <div class="col-xs-6 col-sm-7 top-weapon-weapon__descr">
                <img class="top-weapon-weapon__img img-responsive" [src]="weapon.icon"
                     [alt]="weapon.name">
                <span class="top-match-weapon__title" [innerHtml]="weapon.name"></span>
              </div>
              <div class="col-xs-6 col-sm-5 stat">
                <span [innerHtml]="weapon.percentage | number:'1.2-2'"></span>%
              </div>
            </div>
          </template>
          <hr class="hr--minor visible-xs" *ngIf="i === 0">
        </div>
      </div>
    </div>
  </div>
</div>
