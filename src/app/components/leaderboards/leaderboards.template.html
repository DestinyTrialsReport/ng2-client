<div class="leaderboards">
  <main>
    <div class="maps">
      <div class="card">
        <div class="card__header card__header--high" [ngStyle]="{'background-image': 'url(https://www.bungie.net' + (currentMap$ | async)?.pgcrImage + ')'}">
          <div class="row middle-xs">
            <div class="col-xs">
              <h2 class="card__header__title" [innerHtml]="(currentMap$ | async)?.activityName"></h2>
              <!-- TODO: Add popover in case of rotating maps -->
              <!--<div class="data-label" [innerHtml]="(mapInfo$ | async)?.weekText + '\'s map'"></div>-->
            </div>
            <div class="col-xs-shrink">
              <div class="card__header__controls">
                <button class="btn btn--icon btn--ghost" [style.opacity]="(mapInfo$ | async)?.week > 1 ? 1 : .2"
                        (click)="previousMap()">
                  <i class="material-icons">&#xE5CB;</i>
                </button>
                <button class="btn btn--icon btn--ghost" [style.opacity]="(mapInfo$ | async)?.week == maxWeek ? .2 : 1"
                        (click)="nextMap()">
                  <i class="material-icons">&#xE5CC;</i>
                </button>
              </div>
              <div class="data-label">Other weeks</div>
            </div>
          </div>
        </div>
        <div class="card__content" *ngIf="!(error$ | async)" [ngClass]="{'loading-container': loading}">
          <leaderboard-weapon-types *ngIf="(leaderboardType$ | async) == 'weapon-types'"
                                    [weapons]="(weapons$ | async)"
                                    [weaponType]="(weaponType$ | async)"
                                    [weaponTier]="(weaponTier$ | async)"
                                    [currentWeek]="currentWeek"
                                    [leaderboardType]="(leaderboardType$ | async)"
                                    [leaderboardTypes]="leaderboardTypes"
                                    [itemsPerPage]="10"
                                    [currentPage]="(currentPage$ | async)"
                                    [@loading]="loading$ | async">
          </leaderboard-weapon-types>

          <leaderboard-medals *ngIf="(leaderboardType$ | async) == 'medals'"
                              [medals]="(medals$ | async)"
                              [leaderboardType]="(leaderboardType$ | async)"
                              [leaderboardTypes]="leaderboardTypes"
                              [itemsPerPage]="10"
                              [currentWeek]="currentWeek"
                              [currentPage]="(currentPage$ | async)"
                              [selectedMedal]="(selectedMedal$ | async)"
                              [@loading]="loading$ | async">
          </leaderboard-medals>

          <leaderboard-search *ngIf="(leaderboardType$ | async) == 'select-leaderboard'"
                              [weapons]="(playerWeapons$ | async)"
                              [itemsPerPage]="10"
                              [searchedPlayer]="(searchedPlayer$ | async)"
                              [leaderboardType]="(leaderboardType$ | async)"
                              [leaderboardTypes]="leaderboardTypes"
                              [currentPage]="(currentPage$ | async)"
                              [@loading]="loading$ | async">
          </leaderboard-search>

          <leaderboard-players *ngIf="(leaderboardType$ | async) == 'players'"
                               [players]="(players$ | async)"
                               [itemsPerPage]="10"
                               [selectedWeaponName]="selectedWeaponName$ | async"
                               [weaponList]="weaponList$ | async"
                               [currentWeek]="currentWeek"
                               [currentPage]="(currentPage$ | async)"
                               [leaderboardType]="(leaderboardType$ | async)"
                               [leaderboardTypes]="leaderboardTypes"
                               [@loading]="loading$ | async">
          </leaderboard-players>

          <hr>
          <div class="row">
            <div class="col-xs-12">
              <div class="text-center">
                <pagination-controls (pageChange)="onPageChange($event)"></pagination-controls>
              </div>
            </div>
          </div>
        </div>
        <div class="card__content" *ngIf="(error$ | async)">
          <div class="row">
            <div class="col-xs-12">
              <div class="text-center">
                <p style="color: #F44336;font-size: 1.2em;font-weight: bold;">Request Failed</p>
                <span>Please check gamertag and try again.</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>
</div>
